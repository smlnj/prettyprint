<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="description" content="A manual for PrettyPrint, the new SML/NJ prettyprinter library">
<meta name="author" content="David MacQueen">
<title>PrettyPrint: A New Prettyprinter Library for Standard ML</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>PrettyPrint: A New Prettyprinter Library for Standard ML</h1>
<div class="details">
<span id="author" class="author">David MacQueen</span><br>
<span id="email" class="email"><a href="mailto:dmacqueen@mac.com">dmacqueen@mac.com</a></span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document describes a new prettyprinter library (called PrettyPrint) written in Standard ML
and intended for use in Standard ML programs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The motivation for designing a new prettyprinter was a dissatisfaction with the existing
prettyprinter library for SML/NJ (found in smlnj-lib/PP), which was adapted from the
Format library for OCaml, which in turn is based on ideas from Derek Oppen&#8217;s original 1980
TOPLAS paper combined with ideas from the PPML tool of the Centaur system developed at
INRIA Sophia-Antipolis.</p>
</div>
<div class="paragraph">
<p>Other work that contributed to the current design were the Haskell line of prettyprinters
(Hughes 1995, Wadler 1997, Leijen) that we will call the Wadler-Leijen (WL) family of
prettyprinters. This family includes the current Hackage Prettyprinter package (v. 1.7.1)
with its source code and documentation.</p>
</div>
<div class="paragraph">
<p>Other sources of ideas include a pretty printer designed by Bill Pugh and Steven Sinofsky at
Cornell for use in the Cornell Programm Synthesizer, a strict (OCaml) version of the Wadler
prettyprinter by Christian Lindig, and prettyprinters by Norman Ramsey based on the Lindig
implementation.</p>
</div>
<div class="paragraph">
<p>This prettyprinter is based on a 2-phase, off-line algorithm. A formatter function maps the
value to be prettyprinted to a <em>format</em> data structure, and then the format is rendered to a
<em>layout</em> (<em>e.g.</em>, formatted text on a page or a display) by a render function.</p>
</div>
<div class="paragraph">
<p>Rendering is conditional on a line-length constraint, which controls optional line breaks
and indentation. A format has a "static" measure (its horizontal span when rendered on a
single, unbounded line) that depends only on the structure of the format, and conditional
rendering of the format is based on this static measure.</p>
</div>
<div class="paragraph">
<p>The fundamental structuring notion for formats is the "block", which can be an atomic text item
(a string), or a compound block containing subformats. Indentation is an attribute associated
with compound blocks.</p>
</div>
<div class="paragraph">
<p>The goals of this prettyprinter library are modest. It is not intended to compete with or
replace text formatting systems like Markdown, Asciidoc, HTML, or LaTeX, so "styling" text
and sophisticated layouts (tables and multicolumn) are beyound its scope. The tools for
constructing layouts are limited to deciding where to break lines and how much to indent
after a line break. For the time being, we are limiting ourselves to plain ascii text with
fixed width characters for strings, and thus there is no unicode support. This might
change if and when SML/NJ supports unicode characters and strings.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_synopsis">Synopsis</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sml" data-lang="sml">   structure PrettyPrint : PRETTYPRINT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_concepts_and_terminology">Key Concepts and Terminology</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">Pretty Printing</dt>
<dd>
<p>Pretty printing is the process of presenting a datastructure in text in a "readable" fashion,
using layout, that is, newlines, spacing, and indentation, to make the inherent structure of
the data more obvious. It involves a kind of "markup", meaning that additional information
is overlayed onto the underlying "content" to produce the physical layout when printed. A finite
line width imposes a constraint that can require the layout to be broken across multiple lines.</p>
</dd>
<dt class="hdlist1">Content</dt>
<dd>
<p>The <em>content</em> of a format is the list of text strings appearing in the format,
presented as a list in depth-first, left-to-right order. Usually the content of a format,
stripped of all extraneous white space, should stand on its own, e.g. as a syntactic phrase
in a programming language or data description language. We are ignoring the special cases of
languages where white space (for instance, indentation) has syntactic significance.
A prettyprinter may produce different layouts of the same content, but these layouts are
expected to convey the same "meaning" or "information".</p>
</dd>
<dt class="hdlist1">Format</dt>
<dd>
<p>A format is a data structure that embeds the "contents" (i.e. the strings or tokens that
convey meaning) in additional structure that specifies <em>formatting</em> information for printing
the contents, where white-space will be added to help convey its "logical structure".</p>
</dd>
<dt class="hdlist1">Formatter</dt>
<dd>
<p>A <em>formatter</em> is a function that maps values of a given type (or having a certain data structure)
to a format structure. A formatter has the type <code>t &#8594; format</code> where <code>t</code> is the type of the values
being formatted.</p>
</dd>
<dt class="hdlist1">Layout</dt>
<dd>
<p>A <em>layout</em> is the physical arrangement of the content (strings) and white space produced by
"interpreting" a format in the context of constraints such as the width of the page or display.
A layout can also be a low-level description of what is printed, say as a list of elementary
printing commands (e.g. print a string, print n spaces, print a newline character) or simply
a list of strings (which can include spaces and newline characters) to be printed.</p>
</dd>
<dt class="hdlist1">Rendering</dt>
<dd>
<p><em>Rendering</em> is the process of translating a format into a layout. This process is controlled by
physical or "aesthetic" constraints such as the width of a print line or a <em>ribbon</em> percentage
or width limit that determines how much of a line is occupied by text.</p>
</dd>
<dt class="hdlist1">Blocks</dt>
<dd>
<p>There are two trivial or "atomic" sorts of format: empty and text (a single, unbreakable, string).
All other formats are compound <em>blocks</em>, consisting of a list of elements that can
be either a subformat or a <em>break</em>. A break normally specifies what can happen between
subformats: nothing, a number of spaces, a conditional line break, or an unconditional
line break. A format that is a member of a block may itself be a block, so blocks
can be nested. This fact underlies the notion of the <em>block nesting level</em> of a format element,
which is defined as the number of nested blocks containing that element.</p>
</dd>
<dt class="hdlist1">Breaks</dt>
<dd>
<p>Breaks normally separate the member formats of a compound block format. A <code>Space n</code>
break renders as <code>n</code> (nonbreakable) spaces between the formats it separates. A <code>Soft
n</code> break represents a conditional newline: it can break a line if necessary because there is
not enough remaining space on a line for the next format, in which case we say the
break is <em>triggered</em>; or it may not need to be triggered, in which case it renders as
<code>n</code> spaces. A <code>Hard</code> break always breaks the line between the formats it separates,
and it will be followed by an indentation on the following line [see the item on
<em>indentation</em> below]. Finally, for completeness there is a <code>Null</code> that does
nothing: it neither breaks a line nor produces spacing. Although breaks normally
separate formats in a block, in fact formats and breaks can be arbitrarily
interleaved, and it is even possible for a block to contain only breaks, or only
formats.</p>
</dd>
<dt class="hdlist1">Alignment</dt>
<dd>
<p>By far the most common form of block is one where the member formats are uniformly
separated by the same kind of break. If that break is <code>Space 1</code>, we say that the block
is horizontally aligned, because there will be no line breaks between subformats; if
it is <code>Hard</code>, we say that the block is vertically aligned, since each subformat will
be rendered on a new line (with, by default, the same indentation). If the uniform
break is <code>Soft 1</code>, then each line will be filled until there is not room for the next
subformat, at which point the next conditional break will be triggered and rendering
will continue on the next line; this is called <em>Packed</em> alignment. Finally, the breaks
are all <code>Null</code> (or equivalently, if there are no breaks at all between
subformats), then the subformats will be rendered horizontally along the line, but
with no space between them; we call this <em>Compact</em> alignment.  Since such aligned
blocks are very commonly used, we represent them as a special form of block that
contains a list of subformats and an <em>alignment</em> that encodes the kind of break used
between member formats. The alignment is represented by one of the constant
constructors, <code>H</code>, <code>V</code>, <code>P</code>, or <code>C</code> of the <code>alignment</code> datatype. There is a special
block-building function, <code>ablock</code>, taking an alignment and a list of formats. It is
defined in terms of a corresponding <code>ABLOCK</code> constructor for the format datatype.</p>
</dd>
<dt class="hdlist1">Indentation</dt>
<dd>
<p>Indentation has been a tricky and difficult subject in the development of
prettyprinter libraries.  In our case, indentation involves moving (the layout of) a
format a specified number of spaces to the right&#8201;&#8212;&#8201;no negative indentation is
allowed. An indented format indents the entire format. In some other systems, like the
Wadler-Leijen libraries, indentation is associated with line breaks; indentation may
distribute uniformly into a block-like compound format (cat docs), but in that case,
the indentation only applies to the lines following the indented line breaks, and does
not affect the first line of the block.</p>
<div class="literalblock">
<div class="content">
<pre>Indentation does not make sense, and therefore does not take effect, for a format
whose rendering starts in the middle of a line. Indentation can only be activated to
increment the indentation level of a format that is rendered immediately after a
newline. Hence we have an `inline` function (corresponding to format constructor
INLINE) that is conditional, in that it has effect only when the "indented" format
starts rendering on a new line. In other words, indentation does not imply or entail
a line break, but indentation is only activated after a line break.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>The cumulative effect of nested indentations defines a "left margin", called the
_block left margin_ (or, perhaps more accurately, the _format left margin_). The block
left margin for a block is the default indentation after line breaks in that occur
when rendering that block. For a block that is rendered starting in the middle of a
line, its starting column position becomes its block left margin.  All new lines
within the block have this indentation, unless they start with an indented format, for
which the indentation is increased by the specified number of spaces.</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Flattening</dt>
<dd>
<p>Even when a format contains hard and soft line breaks, we can choose to suppress those
line breaks and render the format on a single line, where the suppressed line breaks are
replaced by single spaces. This is called the flat rendering of the format, and it may
be the right rendering for "short" formats. There is a <code>flat</code> operation, or format
modifier, (corresponding with the FLAT format constructor) that causes the suppression
of line breaks when rendering the flattened format.</p>
</dd>
<dt class="hdlist1">Measurement</dt>
<dd>
<p>A conditional (soft) break within a block will be triggered if the format member
<em>following</em> the soft break does not fit in the remaining space on the line, which is
determined by the line width and the current position on the line (current column).
But how do we measure the size of the format to determine whether it fits? As a
conservative measure of a format, we take the width of that format as rendered flat.
Thus the condition for triggering a soft break is based on the (so far rendered)
contents of the current line, the line width limit, and the measure of the following
format. We might also call this the <em>look ahead</em> policy for triggering soft line breaks.</p>
<div class="literalblock">
<div class="content">
<pre>More elaborate, multi-line notions of the measure of a format, and more "global"
criteria for triggering line breaks are possible, but for simplicity we use the flat
measure of the next following format compared with the remaining space on the current
line for triggering. Some other prettyprinting systems base the triggering of
conditional line breaks on whether the block _containing_ the break fit on the current
line.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>The triggering decisions for soft line breaks are made at "render time" based on values
such as the current column that are only available during the rendering process. The flat
measure of a format, on the other hand, is a "static" property of the format that can be
computed before it is rendered (and can even be memo-ized in the format representation, as
we do).</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_principles_and_assumptions">Principles and Assumptions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_preconditions">Preconditions</h3>
<div class="ulist">
<ul>
<li>
<p>We assume a fixed-width character set, so measurements of format "length" and indentation can
be expressed as character counts.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_nesting_of_blocks">Nesting of blocks</h3>
<div class="ulist">
<ul>
<li>
<p>blocks contain formats and explicit or virtual breaks, and their format elements
can also be blocks or can contain blocks, so arbitrarily deeply nested blocks are supported.</p>
</li>
<li>
<p>Relative to the the context of a "root" format containing a given format or element,
that format or element has a <em>block nesting level</em> (BNL) that represents the depth of
block nesting of that element. The root format has BNL 0, and in general represents the
number of nested blocks containing a format or element.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_text_formats">Text formats</h3>
<div class="ulist">
<ul>
<li>
<p>Text formats considered to be "atomic blocks" consisting of a single string, and contain no
subformats or breaks. The string contents of a text block may contain white space, but generally
should not as a matter of formatting style.</p>
</li>
<li>
<p>Text formats lack the alignment and indentation attributes of compound blocks.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_block_alignment_modes">Block "alignment" modes</h3>
<div class="ulist">
<ul>
<li>
<p><em>Basic</em> blocks lack an alignment property, and treat alignment in an <em>ad hoc</em> way using
user-specified breaks between subformats. The breaks of a basic block can be heterogeneous.</p>
</li>
<li>
<p><em>Aligned</em> blocks can be either horizontal (hblock), vertical (vblock) or packed (pblock), these
are</p>
</li>
<li>
<p>The alignment mode of an aligned block is represented by the value of the alignment field
of the block (H for horizontal alignment, V for vertical alignment, P for packed alignment,
and C for compact alignment). An aligned block has homogeneous (virtual) breaks that separate
its constituent subformats. Those virtual breaks are Space 1 for horizontal alignment (H),
Soft 1 for packed alignment (P), Hard for vertical alignment (V) and Null for
compact alignment &#169;.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_block_indentation_and_block_left_margin_or_blm">Block indentation and "block left margin" or <code>blm</code></h3>
<div class="ulist">
<ul>
<li>
<p>Indentation is an attribute of formats that are created using the <code>indent</code> function.</p>
</li>
<li>
<p>For indented formats, there are two modes of indentation: <em>hard</em> and <em>soft</em>, depending on which
indentation function is used to create them. Technically, a soft indented format is only <em>potentially</em> indented,
with actual indentation depending on whether it immediatly follows a newline caused by a Hard
or triggered Soft break.</p>
</li>
<li>
<p>The indentation of an indented format applies to the complete format, in comparison with other
pretty printing schemes where the indentation only applies after newlines occuring within the block, and
thus does not affect the first line of the block. This is why an indented format (hard indentation
or triggered soft indentation) always starts on a fresh line.</p>
</li>
<li>
<p>The indentation level of a compound block is called the <em>block left margin</em>, or <code>blm</code> for short. The <code>blm</code> is
not a "static" or "structural" property of a block&#8201;&#8212;&#8201;it is determined dynamically during rendering.
All characters printed during the rendering of a block will be at or to the right of that block&#8217;s <code>blm</code>,
and thus the block occupies the "south-east" quadrant determined by the location of its first character.
Thus there in no way to achieve "outdents" or negative incremental indentation, i.e., lines whose
indentation is less than the containing block&#8217;s blm.</p>
</li>
<li>
<p>Thus Indentation is always associated with a preceding newline, because it makes no sense to indent
other than at the beginning of a line. An indented format will always start on an indented new line.</p>
<div class="paragraph">
<p>If a hard indented block is not preceeded by a newline (produced by a Hard break or a triggered
Soft break), then it generates its own newline and adds its indentation to the parent blm to
get its indentation or blm. But if such a block is preceeded by a newline, then it produces only the incremental
indentation n (new blm = parent blm + n). This applies to a hard indented block occurring as the first
component format of a hard indented block or "triggered" soft indented block; an indented block at
the beginning of an indented block does not introduce an additional newline+indent.</p>
</div>
<div class="paragraph">
<p>If a soft indented block (SI n) is preceeded by a newline,
then it increments the parent&#8217;s blm to determine its indentation (new blm = parent blm + n).
If a soft indented block is not preceeded by a newline, then there will be no indentation, and hence
no newline, and the new block&#8217;s blm will be the current column, as usual.</p>
</div>
<div class="paragraph">
<p>Thus a change in indentation is always associated with entering a new indented block, starting on a new line,
with a new, incremented, blm. There is no <em>ad hoc</em> indentation, such as an indentation associated with
a particular line break that applies only to the following line.</p>
</div>
</li>
<li>
<p>The indentation (<code>blm</code>) of a nonindented block is set to the current column when we begin to render the block.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_well_formedness_of_blocks">Well-formedness of blocks</h3>
<div class="ulist">
<ul>
<li>
<p>For basic blocks, breaks typically come between format elements, but it is possible to intermix
subformats (FMT elements) and breaks (BRK elements) arbitrarily, including having no formats or no
breaks at all.</p>
</li>
<li>
<p>For aligned blocks, the (virtual) break for that block is properly interleaved between the subformats
of the block.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rendering_a_format_against_lthe_line_width_constraint">Rendering a format (against lthe line width constraint)</h3>
<div class="paragraph">
<p>We assume that the right margin determined by the line width parameter is <em>soft</em>, and can
be exceeded if necessary: for instance, if a format consists of a very long string that does not
fit within the specified line width.</p>
</div>
<div class="sect3">
<h4 id="_conditional_rendering">Conditional rendering</h4>
<div class="ulist">
<ul>
<li>
<p>Rendering is dependent on a <em>static</em> format measure that depends only on the structure of the format.</p>
<div class="paragraph">
<p><em>flat measure</em> assumes that all newlines are suppressed, with Hard breaks treated as Space 1
and <code>Soft n</code> breaks treated as <code>Space n</code>. The flat measure is essentially the length of the rendered
format if it were rendered on a single, unbounded line.</p>
</div>
<div class="paragraph">
<p>Alternate measures, such as a <em>multi-line</em> measure, are possible, but are not used in this version
(Version 7).</p>
</div>
</li>
<li>
<p>We say that a format <em>fits</em> if its flat measure is less than the space remaining on the current line;
this is a dynamic (render-time) property of a format based on its static measure compared with the
dynamic value of the line space available, which will be the difference between the current column
and the line width (<code>lsp = lw - cc</code>).</p>
</li>
<li>
<p>There are three constructs that introduce conditional rendering:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Soft line breaks, represented by breaks of the form <code>Soft n</code>.</p>
</li>
<li>
<p><em>alt</em> formats, formed by application of the function <code>alt</code>, as in <code>alt (fmt1, fmt2)</code>.</p>
</li>
<li>
<p>Soft indented blocks, for example as produced by <code>hiblock (SI n) fmt</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>A soft line break (break <code>Soft n</code>) is <em>triggered</em> (i.e. rendered as a newline) if the format following it <em>fits</em>. (Note: a <code>Soft</code> break that is not followed by a format is anomalous and will be ignored; this situation could only occur in a basic block.)</p>
</li>
<li>
<p>When rendering the format returned by <code>alt (fmt1, fmt2)</code>, the first format <code>fmt1</code> is rendered if
it <em>fits</em> (<em>i.e.</em>, its measure is less than the line space available), and otherwise the alternate
format <code>fmt2</code> is rendered.</p>
</li>
<li>
<p>A soft indented block with incremental indentation <code>n</code> actually performs
the indentation <code>n</code> (relative to its parent&#8217;s <code>blm</code>) only if it immediately follows a newline+indent,
and otherwise is rendered as an ordinary nonindented block with the same contents.</p>
</li>
<li>
<p>The function <code>flat : format &#8594; format</code>, forces flat rendering and measuring of its argument format.
This function can be used in conjunction with the <code>alt</code> function to define a function like:</p>
<div class="literalblock">
<div class="content">
<pre>fun tryFlat (fmt: format) = alt (flat fmt, fmt)</pre>
</div>
</div>
</li>
<li>
<p>A priority ordering for soft line breaks</p>
<div class="paragraph">
<p>When there is a choice, we prefer to trigger a higher-level (lower BNL) soft line break rather than
a later, lower-level one. The enforcement of this preference is a natural consequence of conditioning
the triggering of soft line breaks on the measure of the immediately following format, because we
use that format&#8217;s flat measure to decide whether to trigger the break. That measure does not take
into account the possibility of internal line breaks when it is rendered.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_semantics_of_a_format_should_be_independent_of_the_layout_produced_by_its_rendering">The "semantics" of a format should be independent of the layout produced by its rendering</h3>
<div class="paragraph">
<p>Removing the "formatting" from a format, leaving only the list of strings (or atomic text
formats) contained in the format, in depth-first, left-to-right order, yields the
<em>content</em> of the format. This content, viewed, for instance, as a sequence of lexical tokens,
should by itself be an adequate representation of the data stucture from which the format
is derived. This should not be surprising, since in almost all "languages" or "serialized
representations" used in computing, the "white space" does not carry meaning&#8201;&#8212;&#8201;it is
only used to delineate the meaningful "tokens" of the language or representation.</p>
</div>
<div class="paragraph">
<p>There are exceptions, such as languages whose syntax uses Landin&#8217;s "offside rule", where
newlines and indentation determine syntactic structure, but we are excluding such
languages (e.g. Python, Haskell, YAML).
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
In any case, this prettyprinter library is not designed to support notations that use such
layout-dependent syntaxes. If the prettyprinted layout is supposed to faithfully represent
layout-based syntax, that is up to the writer of the prettyprinter to achieve that.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interface_newppsrcnewprettyprint_sig">Interface (NEWPP/src/newprettyprint.sig)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_signature_new_prettyprint">signature NEW_PRETTYPRINT</h3>
<h4 id="_types" class="discrete">Types</h4>
<div class="ulist">
<ul>
<li>
<p>type <code>format</code>&#8201;&#8212;&#8201;intended to be abstract from the library user&#8217;s perspective</p>
</li>
<li>
<p>datatype <code>break</code>&#8201;&#8212;&#8201;Used in basic blocks</p>
<div class="literalblock">
<div class="content">
<pre>datatype break       (* breaks are not, and do not contain, content *)
  = Hard         (* hard line break; rendered as a newline + indent to current blm *)
  | Soft of int  (* soft line break (n &gt;= 0); rendered as n spaces, if the line break
                      * is not triggered; if it is triggered, renders as newline + indent
                      * to current blm *)
  | Space of int     (* spaces (n &gt;= 0); rendered as n spaces *)
  | Null        (* does nothing when rendered: no spaces, no line break *)</pre>
</div>
</div>
</li>
<li>
<p>datatype <code>alignment</code>&#8201;&#8212;&#8201;used to determine the alignment of aligned blocks, etc.</p>
<div class="literalblock">
<div class="content">
<pre>datatype alignment
  = H   (* Horizontal, implicit break = Space 1 *)
  | V   (* Vertical, implicit break = Hard *)
  | P   (* Packed, implicit break = Soft 1 *)
  | C   (* Compact, no implicit break *)</pre>
</div>
</div>
</li>
<li>
<p>datatype <code>element</code>&#8201;&#8212;&#8201;the components of basic blocks</p>
<div class="literalblock">
<div class="content">
<pre>datatype element
  = BRK of break
  | FMT of format</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_format_construction_functions" class="discrete">Format construction functions</h4>
<div class="ulist">
<ul>
<li>
<p><code>empty : format</code></p>
<div class="literalblock">
<div class="content">
<pre>The empty format that prints nothing when rendered, equivalent to (text ""). Empty formats are
absorbed by adjacent nonempty formats, so that no "separation" whitespace will be printed between and
empty format and adjacent nonempty formats. Empty serves as an identity element for binary
format concatenation operators. For instance, hcat (fmt, empty) == fmt.</pre>
</div>
</div>
</li>
<li>
<p><code>text : string &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>Create an atomic "text" block consisting of a string, which renders as that string. Note that the string may contain, indeed may consist only of, white space.  As a mater of style, however, whitespace should usually be produced by formatting rather than being built into text strings.</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>General block constructor functions:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>block : element list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>build a block with ad hoc alignment determined by explicit breaks among the elements.</pre>
</div>
</div>
</li>
<li>
<p><code>ablock : alignment &#8594; format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>build an aligned block with the specified alignment.</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Basic (nonindented) block constructor functions:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>block : element list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>block elems : Create a basic block with elems as components.</pre>
</div>
</div>
</li>
<li>
<p><code>hcat : format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>hcat fmts : Create a horizontally aligned block (with implicit (Space 1) breaks) with fmts as components.</pre>
</div>
</div>
</li>
<li>
<p><code>vcat : format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>vcat fmts : Create a vertically aligned block (with implicit Hard breaks) with fmts as components.</pre>
</div>
</div>
</li>
<li>
<p><code>pcat : format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>pcat fmts : Create a "packed" aligned block (with implicit (Soft 1) breaks) with fmts as components.</pre>
</div>
</div>
</li>
<li>
<p><code>ccat : format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>ccat fmts : Create a "compact" aligned block with fmts as components, with no breaks between components.</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_conditional_rendering_2" class="discrete">Conditional rendering</h4>
<div class="ulist">
<ul>
<li>
<p><code>flat : format &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>flat fmt : returns a version of the argument fmt that will be rendered as flat (on a single line) and will have the same flat measure.</pre>
</div>
</div>
</li>
<li>
<p><code>alt : format * format &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>alt (fmt1, fmt2) : the resulting format renders as fmt1 if fmt1 fits, otherwise it renders as fmt2.</pre>
</div>
</div>
</li>
<li>
<p><code>tryFlat : format &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>tryFlat fmt : the result format renders as (flat fmt) if that fits, and otherwise renders as fmt.</pre>
</div>
</div>
</li>
<li>
<p><code>hvblock : format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>hvblock fmts : renders as (hblock fmts) if that fits, and otherwise renders as (vblock fmts).</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_indented_formats" class="discrete">Indented formats</h4>
<div class="ulist">
<ul>
<li>
<p><code>indent : int &#8594; format &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>indent n fmt : indent fmt n additional spaces (relative to parent block's blm) only if immediately
following a line break (newline+indent); otherwise render fmt normally.</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_basic_formats" class="discrete">Basic formats</h4>
<div class="ulist">
<ul>
<li>
<p><code>comma, colon, semicolon, period, lparen, rparen, lbracket, rbracket, lbrace, rbrace, equal : format</code></p>
<div class="literalblock">
<div class="content">
<pre>Punctuation characters as formats (plus the equal symbol).</pre>
</div>
</div>
</li>
<li>
<p><code>integer : int &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>integer n : Returns the string representation of n (Int.toString n) as a text format.</pre>
</div>
</div>
</li>
<li>
<p><code>string : string &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>string s : Formats the string s enclosed in double quotation marks.</pre>
</div>
</div>
</li>
<li>
<p><code>char : char &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>char c : Formats c as "#" ^ (string (Char.toString c)).</pre>
</div>
</div>
</li>
<li>
<p><code>bool : string &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>bool b : Formats the boolean value b as `text "true"` or `text "false"`.</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_utility_format_construction_functions" class="discrete">Utility format construction functions</h4>
<h4 id="_enclosing_a_format" class="discrete">Enclosing a format</h4>
<div class="ulist">
<ul>
<li>
<p><code>enclose : {front: format, back: format} &#8594; format &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>enclose {front, back} fmt : concatenate front, fmt, and back.</pre>
</div>
</div>
</li>
<li>
<p><code>parens: format &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>parens fmt = enclose {front=lparen, back=rparen} fmt
  Enclose fmt with left and right parentheses.</pre>
</div>
</div>
</li>
<li>
<p><code>brackets: format &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>brackets fmt = enclose {front=lbracket, back=rbracket} fmt
  Enclose fmt with left and right square brackets.</pre>
</div>
</div>
</li>
<li>
<p><code>braces: format &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>braces fmt = enclose {front=lbrace, back=rbrace} fmt
  Enclose fmt with left and right curly braces.</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_modifying_a_format" class="discrete">Modifying a format</h4>
<div class="ulist">
<ul>
<li>
<p>`label : string &#8594; format &#8594; format</p>
<div class="literalblock">
<div class="content">
<pre>label str fmt = hcat [(text str), fmt]</pre>
</div>
</div>
</li>
<li>
<p>`appendNewLine : format &#8594; format</p>
<div class="literalblock">
<div class="content">
<pre>append a hard newline after the format</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_formatting_lists_of_formats" class="discrete">Formatting lists of formats</h4>
<div class="ulist">
<ul>
<li>
<p><code>sequence : alignment &#8594; format &#8594; format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>sequence a sep fmts: inserts sep between the elements of fmts, aligning according to a.</pre>
</div>
</div>
</li>
<li>
<p><code>hsequence : format &#8594; format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>hsequence = sequence H</pre>
</div>
</div>
</li>
<li>
<p><code>psequence : format &#8594; format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>psequence = sequence P</pre>
</div>
</div>
</li>
<li>
<p><code>vsequence : format &#8594; format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>vsequence = sequence V</pre>
</div>
</div>
</li>
<li>
<p><code>csequence : format &#8594; format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>csequence = sequence C</pre>
</div>
</div>
</li>
<li>
<p><code>tuple : format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>formats the members of the format list as a "tuple" (parenthesized, with commas
separating members) with default packed (P) alignment of the member formats.</pre>
</div>
</div>
</li>
<li>
<p><code>list : format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>formats the members of the format list as a list (bracketed, with commas
separating the members) with default packed (P) alignment of the member formats.</pre>
</div>
</div>
</li>
<li>
<p><code>val vHeaders : {header1: string, header2: string} &#8594; format list &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>Vertically align the formats of the format list argument with header1 as header
for the first format and header2 as header for subsequent formats. If header1 and header2 are of
unequal sizes, the shorter one is padded with spaces on the left to make its size equal to the
longer.</pre>
</div>
</div>
</li>
<li>
<p><code>option : format option &#8594; format</code></p>
<div class="literalblock">
<div class="content">
<pre>formats `fmtOp: format option` as `text "NONE"` or `ccat (text "SOME", parens (valof fmtOp)).</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_setting_and_accessing_the_line_width" class="discrete">Setting and accessing the line width</h4>
<div class="ulist">
<ul>
<li>
<p><code>setLineWidthFun : (unit &#8594; int) &#8594; unit</code></p>
<div class="literalblock">
<div class="content">
<pre>Defines the function that returns the current lineWidth value.</pre>
</div>
</div>
</li>
<li>
<p><code>resetLineWidthFun : unit &#8594; unit</code></p>
<div class="literalblock">
<div class="content">
<pre>Reset the lineWidthFun to the default lineWidthFun (which returns 90).</pre>
</div>
</div>
</li>
<li>
<p><code>getLineWidth : unit &#8594; int</code></p>
<div class="literalblock">
<div class="content">
<pre>Returns the current line width, obtained by calling the current lineWidthFun function.</pre>
</div>
</div>
</li>
</ul>
</div>
<h4 id="_render_and_print_functions" class="discrete">Render and print functions</h4>
<div class="ulist">
<ul>
<li>
<p><code>render : format * (string &#8594; unit) * int &#8594; unit</code></p>
<div class="literalblock">
<div class="content">
<pre>render (fmt, output, lineWidth): render fmt to output given lineWidth as the right margin.
This prints directly using output without building a "layout" data structure.</pre>
</div>
</div>
</li>
<li>
<p><code>printFormatLW : int &#8594; format &#8594; unit</code></p>
<div class="literalblock">
<div class="content">
<pre>Printing with an explicit lineWidth argument:
printFormat lineWidth fmt = render (fmt, print, lineWidth)</pre>
</div>
</div>
</li>
<li>
<p><code>printFormat : format &#8594; unit</code></p>
<div class="literalblock">
<div class="content">
<pre>printFormat' fmt = printFormatLW (getLineWidth ()) fmt</pre>
</div>
</div>
</li>
<li>
<p><code>printFormatNL : format &#8594; unit</code></p>
<div class="literalblock">
<div class="content">
<pre>printFormat' fmt = printFormatLW (getLineWidth ()) (appendNewLine fmt)</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage_and_examples">Usage and Examples</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>How to produce a blank line in a layout?</p>
<div class="literalblock">
<div class="content">
<pre>val doubleNewline : format = sblock [BRK Hardline, BRK Hard]</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 1. String to "paragraph"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>fun formatPara (s: string) : format =
    let val tokens = String.tokens Char.isSpace s
     in pblock (map text tokens)
    end</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 2. Tree Example from Wadler</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>datatype tree = Node of string * tree list

fun formatTree (Node (s, trees)) =
    ccat (text s, formatTrees trees)

and formatTrees nil = empty
  | formatTrees trees = brackets (vsequence comma (map formatTree trees))

val tree1 =
    Node ("aaa",
	  [Node ("bbbbb",
		 [Node ("ccc", nil),
		  Node ("dd", nil)]),
	   Node ("eee", nil),
	   Node ("ffff",
		 [Node ("gg", nil),
		  Node ("hhh", nil),
		  Node ("ii", nil)])])</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that in this example, there are no Soft breaks or soft indented blocks, so
the rendering of a tree value will not be sensitive to line width.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>- printFormat 80 (formatTree tree1);
aaa[bbbbb[ccc,
          dd],
    eee,
    ffff[gg,
         hhh,
         ii]]</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 3. Wadler&#8217;s second style of formatting trees</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>fun formatTree' (Node (s, trees)) =
    case trees
      of nil =&gt; text s
       | _ =&gt; vblock
                [ccat (text s, lbracket),
                 indent 2  (vsequence comma (map formatTree' trees)),
                 rbracket]</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Yielding:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>- printFormat 80 (formatTree' tree1);
aaa[
  bbbbb[
    ccc,
    dd
  ],
  eee,
  ffff[
    gg,
    hhh,
    ii
  ]
]</pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Simplified SML abstract syntax examples (let expressions, structure decls)</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 4. Simple let expressions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>datatype exp
  = Let of dcl list * exp list
  | Var of string
  | Num of int
  | Plus of exp * exp

and dcl
  = Val of string * exp

fun formatExp (Var s) = text s
  | formatExp (Num n) = integer n
  | formatExp (Plus (exp1, exp2)) =
      pcat (hcat (formatExp exp1, text "+"),
	    indent 2 (formatExp exp2))
  | formatExp (Let (dcls, exps)) =
      tryFlat
        (vblock
	   [hcat (text "let", fmtDcls dcls),
            indent 1 (hcat (text "in", formatExps exps)),
            text "end"])

and formatExps (exps: exp list) =
    tryFlat (vsequence semicolon (map formatExp exps))

and fmtDcl (Val (name, exp)) =
    pcat (hblock [text "val", text name, text "="],
	  indent 4 (formatExp exp))

and fmtDcls dcls = vblock (map fmtDcl dcls)

(* example *)

val exp1 = Let ([Val ("x", Num 1), Val ("y", Num 2)],
                [Plus (Var "x", Num 3), Var "y"]);

val exp1Format = formatExp exp1;

fun test fmt n = printFormatLW n fmt;

val test1 = test exp1Format;</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Outputs:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>- test1 20;
let val x = 1
    val y = 2
 in x + 3; y
end

- test1 80;
let val x = 1 val y = 2 in x + 3; y end</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 5. Simplified SML structure expressions and declarations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>datatype str
  = SVAR of string
  | STRUCT of decl list

and decl
  = VALd of string * string
  | TYPd of string * string
  | STRd of string * str

(* formatStr : (decl -&gt; format) -&gt; str -&gt; format *)
fun formatStr _ (SVAR name) = text name
  | formatStr fdecl (STRUCT decls) =
      vblock [text "struct", indent 2 (vblock (map fdecl decls)), text "end"]

(* formatDecl1 : decl -&gt; format *)
and formatDecl1 decl =
    (case decl
       of VALd (name, def) =&gt; pcat (hblock [text "val", text name, text "="], indent 2 (text def))
	| TYPd (name, def) =&gt; pcat (hblock [text "type", text name, text "="], indent 2 (text def))
	| STRd (name, str) =&gt; pcat (hblock [text "structure", text name, text "="],
				    indent 2 (tryFlat (formatStr formatDecl1 str))))

fun formatDecl2 (STRd (name, STRUCT decls)) =
      vblock
        [hblock [text "structure", text name, text "=", text "struct"],
	 indent 2 (vblock (map formatDecl2 decls)),
	 text "end"]
  | formatDecl2 decl = formatDecl1 decl

(* examples *)

val str1 = STRUCT [TYPd ("t", "int list"), VALd ("x", "3")]

val str2 = STRUCT [TYPd ("s", "bool"), VALd ("y", "true"), STRd ("S", str1)]

val strd1 = STRd ("A", str1)
val strd2 = STRd ("B", str2)

fun test fmt n = printFormatLW n fmt

val t11 = test (formatDecl1 strd1)
val t12 = test (formatDecl2 strd1)

val t21 = test (formatDecl1 strd2)
val t22 = test (formatDecl2 strd2)</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Outputs:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>(* using formatDecl1: *)

- t11 80;
structure A = struct type t = int list val x = 3 end

- t11 30;
structure A =
  struct
    type t = int list
    val x = 3
  end

- t12 80;
structure B =
  struct
    type s = bool
    val y = true
    structure S = struct type t = int list val x = 3 end
  end

- t12 30;
structure B =
  struct
    type s = bool
    val y = true
    structure S =
      struct
        type t = int list
        val x = 3
      end
  end

(* using formatDecl2: *)

- t21 20;
structure A = struct
  type t = int list
  val x = 3
end

- t22 80;
structure B = struct
  type s = bool
  val y = true
  structure S = struct
    type t = int list
    val x = 3
  end
end</pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Correspondences with Haskell Prettyprinter interface</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rough analogs of Haskell Prettyprinter types and functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>      Haskell Prettyprinter     Prettyprinter
      ---------------------     -------------

      type doc                  type format

      &lt;+&gt;                       hcat

      hsep                      hcat

      vsep                      vcat

      fillsep                   pcat

      sep                       hvcat

      hcat                      ccat

      vcat xs                   alt (vcat xs, hcat xs); hvcat

      enclose, surround         enclose

      Union, group              alt, tryFlat

      flatten                   flat (from format data constructor FLAT)

      nest                      indent</pre>
</div>
</div>
<div class="paragraph">
<p>An important differnce is the in WL, <code>nest</code> acts on <code>LINE</code> line breaks, while
in our library, <code>indent</code> works on entire formats.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation">Implementation</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">The format and element datatypes:</div>
<div class="content">
<pre>datatype format
  = TEXT  of string
  | BLOCK of {elements: element list, measure: int}
  | ABLOCK of {formats: format list, alignment: alignment, measure: int}
  | INDENT of int * format
  | FLAT of format
  | ALT of format * format

and element       (* of a BLOCK *)
  = BRK of break  (* breaks are _not_, and do not contain, content *)
  | FMT of format</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TEXT</code>, <code>BLOCK</code>, and <code>ABLOCK</code> constructors are used to construct formats, while the
<code>INDENT</code> and <code>FLAT</code> constructors are used to <em>modify</em> formats. Finally, the <code>ALT</code> constructor
provides for a conditional choice between two formats.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The datatype constructors for formats</p>
<div class="ulist">
<ul>
<li>
<p><code>EMPTY</code> is the empty format that prints nothing and acts as an identity element with respect to
concatenation of formats when forming blocks.</p>
</li>
<li>
<p><code>TEXT</code> constructs atomic text blocks whose content is a nonbreakable string.</p>
</li>
<li>
<p><code>BLOCK</code> constructs <em>basic</em> blocks with explicit break (<code>BRK</code>) elements interleaved with format (<code>FMT</code>) elements.</p>
</li>
<li>
<p><code>ABLOCK</code> constructs "aligned" blocks, where alignment is determined by the choice of the alignment,
which in turn determines the virtual break between component formats: Horizontal: <code>Space 1</code>,
Vertical: <code>Hard</code>, Packed: <code>Soft 1</code>.</p>
</li>
<li>
<p><code>FLAT</code> converts an arbitrary format to one which is rendered as flat.</p>
</li>
<li>
<p><code>ALT</code> takes a pair of formats, <code>(fmt1, fmt2)</code> and constructs a format that is
rendered as <code>fmt1</code> if it fits, and otherwise is rendered as <code>fmt2</code>. Note that the two formats are not
constrained to have the same content; for instance, <code>fmt2</code> might be an abbreviated version of <code>fmt2</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Format measure, memoization</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The measure of a <code>TEXT</code> block is just the length of its string contents.</p>
</div>
<div class="paragraph">
<p>The measure of a <code>FLAT</code> format is just the (default, flat) measure of its component format.
The measure of a <code>ALT (fmt1, fmt2)</code> format is the (flat) measure of <code>fmt1</code>, which is normally
expected to be the "wider" of the two formats.</p>
</div>
<div class="paragraph">
<p>The measure of a compound block format is the length of the format as rendered on a single, unbounded line.
This is the sum of the flat measures of its component formats plus <code>breakMeasure b</code> for each explicit or
implicit break <code>b</code>, where <code>breakMeasure</code> is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fun breakMeasure (Space n) = n
  | breakMeasure (SoftLine n) = n
  | breakMeasure Hard = 1
  | breakMeasure Null = 0</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>measure</em> fields of the <code>BLOCK</code> and <code>ABLOCK</code> constructors are used to <em>memoize</em> the measure function
over formats to avoid having to recompute the measures of nested blocks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rendering</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>FLAT</code> formats (used in <code>tryFlat</code>, for instance) are rendered <em>flat</em>, meaning that all breaks <code>s</code>
are rendered as though they were <code>Space (sepMeasure s)</code>, and no newline+indent are generated when
rendering indented blocks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_discussion">Discussion</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>How is an indented block rendered?</p>
<div class="ulist">
<ul>
<li>
<p>The indentation of an indented block is conditional, and is <em>triggered</em> when the indented
block comes immediately after a line break (meaning a newline character followed by indentation).</p>
</li>
<li>
<p>The subformats of a vblock (vertically aligned block) are separated by unconditional line breaks,
so any indented subformat in a vblock, other than the first, will be triggered. If the first
subformat of a vblock is indented, it will be triggered only if the whole vblock occurs immediately
after a (triggered) line break.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The importance of the blm boundary (and no "outdent").</p>
<div class="paragraph">
<p>We claim that the "semantics" of prettyprinting is simplified if the content of a block
is bounded by a left margin, the <code>blm</code>, determined by the column in which the block starts. This goes
along with the indentation principle: a block is indented as a whole, and the indentation applies to
the entire content of the block. Other systems, where indentation only applies after newlines in a
block&#8217;s multi-line layout, make it harder to keep track of the indentation structure and what it
represents in terms of the data structure being presented.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_future_work_possible_new_features_or_improvements">Future Work (possible new features or improvements)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Multi-line measurement of formats (this has been implemented in Version 8 of this library).</p>
</li>
<li>
<p>Tabs. Setting tabs would be related to breaks and would only be accessible at a block&#8217;s
"top level".</p>
</li>
<li>
<p>Tabular formatting (i.e. tables).</p>
</li>
<li>
<p>Rendering to a layout type (instead of printing directly in the render function).</p>
</li>
<li>
<p>Ribbon percentage as a second constraint controling rendering. This should be easy to
add to this scheme.</p>
</li>
<li>
<p><em>styles</em> (similar to WL <em>annotations</em>).</p>
<div class="ulist">
<ul>
<li>
<p>Color and emphasis (italics and boldface).</p>
</li>
<li>
<p>Non-fixed width characters (fonts and type faces, unicode).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Alternate rendering targets (e.g. HTML);</p>
</li>
<li>
<p><em>Holophrastic</em> formatting or rendering, <em>i.e.</em>, truncating or abbreviating to conserve space.</p>
<div class="paragraph">
<p>This is probably not something that should be supported in a generic way by the prettyprinting
library. It is normally implemented as part of a particular prettyprinter (set of formatter functions).
For instance, in the SML/NJ prettyprinters for abstract syntax and for various IRs, a "printdepth" parameter
is passed through the formatters and is decremented as we enter each new level of structure. When the
printdepth parameter reaches 0, we cut off formatting and instead produce a generic symbol or a symbol representing
a syntax class to represent the unprinted structure at greater depths.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Sometimes such languages also have alternative "linear" syntaxes that use explicit lexical notations to convey structure and hence do not depend on white space (i.e. dependence on white space is optional).
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-03-07 11:44:54 -0800
</div>
</div>
</body>
</html>